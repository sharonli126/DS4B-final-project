---
title: "Life History Traits and Maximum Longevity in Mammalia"
author: "Tsz Ching Li u7630977"
date: "4 Oct 2023"
output:  
    html_document:
        toc: true
        toc_depth: 4
        theme: cosmo
        number_sections: false
        toc_float: true
        highlight: pygments
        fig_width: 8
        fig_height: 4
---
# Word/figure count

Words: []
Figures: []

# Location on GitHub

https://github.com/sharonli126/DS4B-final-project 

# Data Description

AnAge is a database recording the longevity, ageing and life history across over 4000 animal species which researchers have collected and published relevant data and is freely available online. It was developed by researchers at the Human Ageing Genomic Resources (HAGR), encompassed species data with key attributes include taxonomic classification (from kingdom to species), common names, developmental milestone (eg: maturity days for both genders), reproductive traits (gestation/ incubation days, weaning days, and litter/ clutch sizes), physiological characteristics (adult weight and metabolic rate), and maximum longevity. To reduce bias of sample size of lifespan record, comparative longevity studies were performed with estimate sample size, and it is recorded in the dataset along with the determined quality. This data can be widely used in biological field, such as zoology, ecology, physiology and conservation biology (De-Magalhães & Costa, 2009).    

# Questions/Aims

__How do life-history traits leads to diversity of longevity between four orders (Primates, Rodentia, Carivora and Artiodactyla)?__

[A brief section which first states and then justifies the questions/aims of your EDA. Must provide evidence of independent research into what has been done before on these questions/aims. See above for examples.]

Why do some animals live only a few years, but some can live several years, or even over a hundred year? This has been one of the most interesting questions in Biology all the time. While animals varies in lifespan, the order of Mammalia, which we, humans belong to, particularly present a diverse of lifespan. For hamster or mouse, they only have around 4 years lifespan but for a gorilla, it can live up to around 60 years, or humans and whales can live even over 100 years old! 

There are various of life-history traits in the class of mammalia, such as Primates tend to have longer lifespans, extended juvenile dependency periods, and fewer offspring, while most rodents reproduce quickly, have shorter lifespans, and produce more offspring in their lifetime. Meanwhile, species of Carnivora, like lions and bears, exhibit a range of lifespans and reproductive strategies, but have the lifespan is relatively higher than Rodentia. Similarly, Artiodactyla, which deer and cattle belong to, also presents its own unique life-history patterns.

Therefore, to understand deeper of which trait correlate the most with lifespan in different order of mammalia, this study analyse a big database of aging and life history in over 4600 animal species from AnAge, aiming to examine and compare the different life history traits impact on maximum longevity among mammalia, particularly in four larger order group in mammalia, including Primates, Rodentia, Carnivora and Artiodactyla.

# Raw data

[Explains how and where to get the exact raw data you got]
[Is reproducible by a person (required) and a machine (ideally)]

```{r, include = F}
library(readr)
library(skimr)
library(janitor)
library(tidyverse)
library(knitr)
```


```{r}
raw_data <- read_delim("raw_data/anage_data.txt", 
                   delim = "\t", 
                   escape_double = FALSE, 
                   trim_ws = TRUE)

```

This data is download from AnAge (URL: https://genomics.senescence.info/species/dataset.zip)

It is reproducible with reference mentioned.


# Data wrangling

Since the data is originally "each variable forms a column, each observation forms a row and each type of observational unit forms a table", so only column names are tidied.
```{r}
tidied_data <- raw_data |>
  clean_names()

write.csv(tidied_data, 
          "/Users/lisharon/Documents/GitHub/DB4S_final_project/processed_data/tidied_data.csv", 
          row.names = FALSE)

```

Considering the reliability of this study, only trait with more than 0.55 complete rate will be examined and order with more than 150 rows will be observed, for filtering an acceptable sample size.

```{r}
mammalia <- tidied_data[tidied_data$class == "Mammalia",]

mammalia |> group_by(order) |> summarise(n = n()) |> arrange(desc(n))
```

```{r}
skim(mammalia) |> filter(complete_rate > 0.55)
```

Therefore, the order of Rodentia, Carnivora, Primates and Artiodactyla are selected and trait including day of female maturity, gestation and weaning, number of babies per time and year, and adult weight.

```{r}
# Filter data need for this report

mammalia_subset <- mammalia[, c("hagrid", "kingdom", "phylum", "class", "order", "family", "genus", "species", "female_maturity_days", "gestation_incubation_days", "weaning_days", "litter_clutch_size", "litters_clutches_per_year", "adult_weight_g", "maximum_longevity_yrs" )]

combined_order <- mammalia_subset[mammalia_subset$order %in% c("Rodentia", "Carnivora", "Primates", "Artiodactyla"),]
```

Some weird data were identified and noted in the excluded data, by using grouping each order by genus, since species within the same genus should have a relative similar trait, then the mean ,and range of minimum value and maximum value were found, and using the 'summarise()' function to organised a table for visualizing which trait have a range to mean ratio over 1:2. After spotting out suspected genus, I will go to the table and have a look which species quite diverse to its genus group and online search whether there is other website/ paper mentioning its proper value for that trait. All data vary from information online will be noted in the excluded data.

```{r}
excluded_data <- read_csv("processed_data/excluded_data.csv")
```

Since I am going to use the data with "na" for EDA and data without NA for linear model and correlation, therefore, there is two cleaned data, where cleaned_data is with "na", and clenaed_na_rm_data is without any "na' value 

```{r}
cleaned_data <- combined_order |> 
  filter(!hagrid %in% excluded_data$hagrid)

write.csv(cleaned_data, 
          "/Users/lisharon/Documents/GitHub/DB4S_final_project/processed_data/cleaned_data.csv", 
          row.names = FALSE)
```

```{r}
cleaned_na_rm_data <- cleaned_data |>
  na.omit()

write.csv(cleaned_na_rm_data, 
          "/Users/lisharon/Documents/GitHub/DB4S_final_project/processed_data/cleaned_na_rm_data.csv", 
          row.names = FALSE)
```

Both cleaned_data and cleaned_na_rm_data are pivoted longer for plotting.

```{r}
long_cleaned_data <- cleaned_data |> 
  pivot_longer(c(female_maturity_days, gestation_incubation_days, 
                 weaning_days, litter_clutch_size, 
                 litters_clutches_per_year, adult_weight_g), 
               names_to = "trait",
               values_to = "value") |>
  mutate(trait = recode(trait,
                        female_maturity_days = "Female Maturity (days)",
                        gestation_incubation_days = "Pregnancy Period (days)",
                        weaning_days = "Stopped Milk Feeding (days)", 
                        litter_clutch_size = "Number of Babies in each Pregnancy",
                        litters_clutches_per_year = "Number of Babies per Year", 
                        adult_weight_g = "Adult Weight (g)"))
```

```{r}
long_cleaned_na_rm_data <- cleaned_na_rm_data |> 
  pivot_longer(c(female_maturity_days, gestation_incubation_days, 
                 weaning_days, litter_clutch_size, 
                 litters_clutches_per_year, adult_weight_g), 
               names_to = "trait",
               values_to = "value") |>
  mutate(trait = recode(trait,
                        female_maturity_days = "Female Maturity (days)",
                        gestation_incubation_days = "Pregnancy Period (days)",
                        weaning_days = "Stopped Milk Feeding (days)", 
                        litter_clutch_size = "Number of Babies in each Pregnancy",
                        litters_clutches_per_year = "Number of Babies per Year", 
                        adult_weight_g = "Adult Weight (g)"))
```

# Sanity checks

[R chunks and prose which perform sanity checks on your cleaned data]
[Remember that this really just summarises that your data are OK after you've cleaned them]
[Most of the real sanity checks and data cleaning go on in the data_cleaning.Rmd file]

```{r}
skim(cleaned_data)
```

There should be no missing data for any columns for cleaned_na_rm_data.

```{r}
skim(cleaned_na_rm_data)
```

```{r}
str(cleaned_data)
```


# Addressing the questions/aims

[This is the *main* section of your work. For example, if you are doing an EDA, this is where you would summarise it. If you are building something like a package or shiny app, a description of that package / app and demonstration of its function(s) would go here. Use appropriate sub-headings.]


## Exploratory Data Analysis

### Histogram of Maximum Longevity of the Four Orders
```{r}
ggplot(long_cleaned_data, aes(x = maximum_longevity_yrs)) +
  geom_histogram() +
  labs(x = "Max. Longevity (year)") +
  scale_x_continuous(breaks=seq(0, 120, by=20)) +
  facet_wrap(~ order) +
  theme_minimal()
```

According to the histogram, the maximum longevity of Primates is spread mainly between 10 to 60 years, with few at above 60 or over 120 years. Carnivora has a similar distribution as Artiodactyiam whereas both of them have a range from 10 to 60, but Artiodactyia has a larger count in from 20-40.  While longevity of Rodentia are all below 45 years, and half of them are below 10 years of lifespan, which is obviously lower than all the others in general. 

In this study, one of the challenge faced is the presence of missing value in data. To address this, both missing value retained data and removed data are anaylsed by visuliation, which allow pattern in both data be observed and compared.

### Correlation of Different Traits and Maximum Longevity (with missing value)

```{r, fig.height=10}
ggplot(long_cleaned_data, aes(x = value, y = maximum_longevity_yrs, color = order)) +
  geom_point(aes(color = order), alpha = .1) +
  geom_smooth( method = "lm", alpha = .1, se = F, color = "black") +
  geom_smooth(aes(color = order), method = "lm", alpha = .5) +
  labs(y = "Max. Longevity (year", x = "Value of each Trait") +
  facet_wrap(~ trait, scales = "free", ncol = 2) +
  theme_minimal()
```

### Correlation of Different Traits and Maximum Longevity (without missing value)

```{r, fig.height=10}
ggplot(long_cleaned_na_rm_data, aes(x = value, y = maximum_longevity_yrs)) +
  geom_point(aes(color = order), alpha = .1) +
  geom_smooth( method = "lm", alpha = .1, se = F, color = "black") +
  geom_smooth(aes(color = order), method = "lm", alpha = .5) +
  labs(y = "Max. Longevity (year)", x = "Value of each Trait") +
  facet_wrap(~ trait, scales = "free", ncol = 2) +
  theme_minimal()
```

As compared with the plotting with missing valuee, the trend of all line did not change, but most of its slope changed due to less sample size has shifted the correlation. However, both number of babies in each pregnancy and each year remain negative correlated, while other four traits have shown positive correlation with the longevity in all order group.

## Correlation Test

The correlation test can provide a quick look on the strength and direction of linear relationship among each trait and the longevity. With this comparative measurement applied in the data with missing value, trait with the most substantial relationship with longevity can be identified in a larger sample size.

```{r}
get_cor <- function(data, trait) {
  
  cor.test(data$maximum_longevity_yrs, data[[trait]])$estimate
  
}

data = cleaned_data
  
overall_cor <- c(get_cor(data, "female_maturity_days"), 
                 get_cor(data, "gestation_incubation_days"), 
                 get_cor(data, "weaning_days"),
                 get_cor(data, "litter_clutch_size"),
                 get_cor(data, "litters_clutches_per_year"),
                 get_cor(data, "adult_weight_g"))

summary_cor <- data.frame(Trait = c("Female Maturity (day)", "Pregnancy Period (day)", "Milk Feeding Stop (day)", 
                                    "Number of Babies per Pregnancy", "Number of Babies per Year", "Adult Weight (g)"),
                          Overall = round(overall_cor, 3)
                          )

for (i in unique(long_cleaned_data$order)) {
  
  filtered <- cleaned_data[cleaned_data$order == i,]
    
  current_cor <- c(get_cor(filtered, "female_maturity_days"), 
                 get_cor(filtered, "gestation_incubation_days"), 
                 get_cor(filtered, "weaning_days"), 
                 get_cor(filtered, "litter_clutch_size"), 
                 get_cor(filtered, "litters_clutches_per_year"), 
                 get_cor(filtered, "adult_weight_g"))
  
  summary_cor[[i]] <- round(current_cor, 3)
  
}

kable(summary_cor)

```

The correlation test have reflected the same trend as the visualization of both data in the previous section. Female maturity and pregnancy period were having the highest correlation overall. However, different degree of correlation were found in all the selected order. **
 
## Linear model

Linear model can statistically show which independent variables (life history trait/ physiological characteristic) significantly associate with dependent variable (maximum longevity) for mammalia in general and each order.


```{r}
library(broom)

linear_model_pvalue <- function(data) {
  model <- lm(data = data,
            maximum_longevity_yrs ~ 
              female_maturity_days +
              weaning_days +
              gestation_incubation_days +
              litter_clutch_size +
              litters_clutches_per_year +
              adult_weight_g
              ) |> 
    tidy()
  
  pvalue <- model$p.value[-1]
  
  return(pvalue)
}

summary_lm <- data_frame(Trait = c("Female Maturity (day)", "Pregnancy Period (day)", "Milk Feeding Stop (day)", 
                                    "Number of Babies per Pregnancy", "Number of Babies per Year", "Adult Weight (g)"),
                         Overall = linear_model_pvalue(cleaned_na_rm_data)
)

for (i in unique(cleaned_na_rm_data$order)) {
  
  filtered <- cleaned_na_rm_data[cleaned_na_rm_data$order == i,]
    
  
  summary_lm[[i]] <- linear_model_pvalue(filtered)
  
}

summary_lm
```

```{r}
convert_to_word <- function(p) {
  ifelse(p < 0.001, "***",
         ifelse(p < 0.01, "**",
                ifelse(p < 0.05, "*",
                       ifelse(p < 0.1, ".", " "))))
}

summary_lm_word <- summary_lm %>%
  mutate_at(vars(-Trait), convert_to_word)

kable(summary_lm_word, caption = "Significance of Linear Model Fitting")

```

Note:

"***": Highly Significant

"**" : Very Significant 

"*"  : Significant

"."  : Suggestion of Association

" "  : Not Significant




# References

1 DE MAGALHÃES, J.P. and COSTA, J. (2009), A database of vertebrate longevity records and their relation to other life-history traits. Journal of Evolutionary Biology, 22: 1770-1774. https://doi.org/10.1111/j.1420-9101.2009.01783.x

2 Lee, P. C. (1996) The meanings of weaning: Growth, lactation, and life history. Evolutionary anthropology. [Online] 5 (3), 87–98.

3 Tacutu, R., et al. (2013). Human Ageing Genomic Resources: integrated databases and tools for the biology and genetics of ageing. Nucleic acids research, 41(Database issue), D1027–D1033. https://doi.org/10.1093/nar/gks1155





word_count("final_project.Rmd")